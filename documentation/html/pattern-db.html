<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>pattern-db</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="../clips.css" />
    <style>
        /* Small fixes because we omit the online layout.css. */
        h3 { line-height: 1.3em; }
        #page { margin-left: auto; margin-right: auto; }
        #header, #header-inner { height: 175px; }
        #header { border-bottom: 1px solid #C6D4DD;  }
        table { border-collapse: collapse; }
    </style>
</head>
<body class="node-type-page one-sidebar sidebar-right section-pages">
    <div id="page">
    <div id="page-inner">
    <div id="header"><div id="header-inner"></div></div>
    <div id="content">
    <div id="content-inner">
    <div class="node node-type-page"
        <div class="node-inner">
        <div class="breadcrumb">View online at: <a href="http://www.clips.ua.ac.be/pages/pattern-db" class="noexternal" target="_blank">http://www.clips.ua.ac.be/pages/pattern-db</a></div>
        <h1>pattern.db</h1>
        <!-- Parsed from the online documentation. -->
        <div id="node-1432" class="node node-type-page"><div class="node-inner">
<div class="content">
<h3>The pattern.db module includes wrappers for popular databases (SQLite + MySQL) and Unicode CSV files. It offers a convenient way to work with tabular data, for example retrieved with the pattern.web module.</h3>
<p>It can be used by itself or with other <a href="pattern.html">pattern</a> modules: <a href="pattern-web.html">web</a> | db | <a href="pattern-en.html">en</a> | <a href="pattern-search.html">search</a> <span class="blue">&nbsp;</span>| <a href="pattern-vector.html">vector</a> | <a href="pattern-graph.html">graph</a>.</p>
<p><img src="../g/pattern_schema.gif" alt="" width="620" height="180" /></p>
<h2>
<hr /></h2>
<h2>Documentation</h2>
<ul style="margin-top: 0;">
<li><a href="#database">Database</a>&nbsp;<span class="smallcaps link-maintenance">(sqlite + mysql)</span></li>
<li><a href="#table">Table</a></li>
<li><a href="#query">Query</a></li>
<li><a href="#view">View</a></li>
<li><a href="#datasheet">Datasheet</a>&nbsp;<span class="smallcaps link-maintenance">(csv)</span></li>
<li><a href="#date">Date</a></li>
</ul>
<p>&nbsp;</p>
<hr />
<h2><a name="database"></a>Database</h2>
<p>A <span class="inline_code">Database</span> is a collection tables. A <span class="inline_code">Table</span> contains rows of data, with a specific data type (e.g., string, integer) for each field (column).&nbsp;A database is typically managed by a robust engine such as MySQL. Statements written in SQL (<em>Structured Query Language</em>) are used to interact with the engine.&nbsp;The <span class="inline_code">pattern.db</span> module is a wrapper for SQL. It&nbsp;supports the <span class="inline_code">SQLITE</span>&nbsp;and&nbsp;<span class="inline_code">MYSQL</span> engines.&nbsp;</p>
<p>SQLite is already included with Python 2.5+. With older versions you need to install <a href="http://code.google.com/p/pysqlite/downloads/list" target="_blank">PySQLite</a>. To use MySQL, you need to install <a href="http://www.mysql.com/" target="_blank">MySQL</a> and <a href="http://sourceforge.net/projects/mysql-python/" target="_blank">MySQL-Python</a>. If you have a 64-bit Python you'll need a 64-bit MySQL and MySQLdb.</p>
<p><span class="inline_code">Database()</span> creates (if necessary) and returns a database. With <span class="inline_code">SQLITE</span>, this will generate a file with the given name in the current folder.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">db = Database<span style="">&#40;</span><br />
&nbsp; &nbsp; &nbsp; name, <br />
&nbsp; &nbsp; &nbsp; host = <span style="color: #657a8a;">'localhost'</span>, <br />
&nbsp; &nbsp; &nbsp; port = <span style="color: #666;">3306</span>, <br />
&nbsp; username = <span style="color: #657a8a;">'root'</span>, <br />
&nbsp; password = <span style="color: #657a8a;">''</span>, <br />
&nbsp; &nbsp; &nbsp; type = SQLITE<br />
<span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">db.<span style="">type</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># SQLITE | MYSQL</span><br />
db.<span style="">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Database name.</span><br />
db.<span style="">host</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Database host.</span><br />
db.<span style="">port</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Database port.</span><br />
db.<span style="">username</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Database username (MySQL).</span><br />
db.<span style="">password</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Database password (MySQL).</span><br />
db.<span style="">tables</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of (name, Table)-items.</span><br />
db.<span style="">relations</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of relations, see Database.link().</span><br />
db.<span style="">query</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Last SQL query string.</span><br />
db.<span style="">connected</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># True after Database.connect(). </span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">db.<span style="">connect</span><span style="">&#40;</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Happens automatically.</span><br />
db.<span style="">disconnect</span><span style="">&#40;</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">db.<span style="">create</span><span style="">&#40;</span>table, fields=<span style="">&#91;</span><span style="">&#93;</span><span style="">&#41;</span><br />
db.<span style="">remove</span><span style="">&#40;</span>table<span style="">&#41;</span><br />
db.<span style="">link</span><span style="">&#40;</span>table1, field1, table2, field2, join=LEFT<span style="">&#41;</span> </code></span><span class="geshifilter"><code class="python geshifilter-python">db.<span style="">execute</span><span style="">&#40;</span>SQL, commit=<span style="color: #4a587c;">False</span><span style="">&#41;</span><br />
db.<span style="">commit</span><span style="">&#40;</span><span style="">&#41;</span><br />
db.<span style="">escape</span><span style="">&#40;</span>value<span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># &quot;a cat's tail&quot; =&gt; &quot;'a cat\'s tail'&quot;</span></code></span></p>
<ul>
<li><span class="inline_code">Database.execute()</span> returns the results from a raw SQL query.</li>
<li><span class="inline_code">Database.commit()</span> commits the changes after a&nbsp;<span class="inline_code">INSERT</span>, <span class="inline_code">UPDATE</span>, <span class="inline_code">DELETE</span>&nbsp;SQL query.</li>
<li><span class="inline_code">Database.escape()</span>&nbsp;safely quotes and escapes a field value.<br />Also see the source code for <span class="inline_code">abs()</span> and <span class="inline_code">cmp()</span>&nbsp;when constructing a raw SQL query.</li>
</ul>
<h3>Creating a table</h3>
<p><span class="inline_code">Database.create()</span> creates a new table in the database, from a given table name and a list of row fields, defined with the <span class="inline_code">field()</span> function:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">field<span style="">&#40;</span>name, type=STRING, default=<span style="color: #4a587c;">None</span>, index=<span style="color: #4a587c;">False</span>, optional=<span style="color: #4a587c;">True</span><span style="">&#41;</span></code></span></p>
<p>Each field has a <span class="inline_code">name</span> and a&nbsp;<span class="inline_code">type</span>, with an optional <span class="inline_code">default</span> value for new rows. Field names should contain only characters (a-z) and underscores. The default value for a&nbsp;<span class="inline_code">DATE</span> field is <span class="inline_code">NOW</span> (current date &amp; time). With <span class="inline_code">optional=True</span>, the field is allowed to contain <span class="inline_code">None</span>.</p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Type</span></td>
<td><span class="smallcaps">Value</span>&nbsp;</td>
<td><span class="smallcaps">Example</span>&nbsp;</td>
</tr>
<tr>
<td><span class="inline_code">STRING</span></td>
<td><span class="inline_code">str</span>, <span class="inline_code">unicode</span>&nbsp;<span class="small">(1-255 characters)</span></td>
<td>&nbsp;<span class="inline_code">u'Schrödinger'</span></td>
</tr>
<tr>
<td><span class="inline_code">INTEGER</span></td>
<td><span class="inline_code">int</span></td>
<td><span class="inline_code">42</span></td>
</tr>
<tr>
<td><span class="inline_code">FLOAT</span></td>
<td><span class="inline_code">float</span></td>
<td><span class="inline_code">3.14159</span></td>
</tr>
<tr>
<td><span class="inline_code">TEXT</span></td>
<td><span class="inline_code">str</span>, <span class="inline_code">unicode</span></td>
<td><span class="inline_code">open('file.txt').read()&nbsp;</span></td>
</tr>
<tr>
<td><span class="inline_code">BLOB</span></td>
<td><span class="inline_code">str</span>&nbsp;<span class="small">(binary: PDF, PNG, ...)</span></td>
<td><span class="inline_code">Database.binary(open('cat.jpg').read())</span></td>
</tr>
<tr>
<td><span class="inline_code">BOOLEAN</span></td>
<td><span class="inline_code">bool</span></td>
<td><span class="inline_code">True</span>,&nbsp;<span class="inline_code">False</span></td>
</tr>
<tr>
<td><span class="inline_code">DATE</span></td>
<td><span class="inline_code">Date</span></td>
<td><span class="inline_code">date('1999-12-31 23:59:59')</span></td>
</tr>
</tbody>
</table>
<p>By default, a&nbsp;<span class="inline_code">STRING</span> field can hold up to a 100 characters, but the length (1-255) can be changed by calling <span class="inline_code">STRING</span> like a function: e.g., <span class="inline_code">STRING(255)</span>. For longer strings, use <span class="inline_code">TEXT</span>.</p>
<p>With&nbsp;<span class="inline_code">index=True</span>, the field is indexed for faster search. The index can also be set to <span class="inline_code">UNIQUE</span>&nbsp;(no duplicates allowed in this column) or&nbsp;<span class="inline_code">PRIMARY</span>. A table should have a primary key field that uniquely identifies each row (i.e., an id). You can use the <span class="inline_code">pk()</span> function, which creates an <span class="inline_code">INTEGER</span> primary key field named <span class="inline_code">id</span>. Integer primary keys are auto-numbered – no need to set the value manually in a new row.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">pk<span style="">&#40;</span>name=<span style="color: #657a8a;">'id'</span><span style="">&#41;</span> <span style="color: grey;"># type=INTEGER + index=PRIMARY + optional=False </span></code></span></p>
<p>For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Database, field, pk, STRING, BOOLEAN, DATE, NOW, date<br />
<span style="">&gt;&gt;&gt;</span> db = Database<span style="">&#40;</span><span style="color: #657a8a;">'my_stuff'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">create</span><span style="">&#40;</span><span style="color: #657a8a;">'pets'</span>, fields=<span style="">&#91;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; pk<span style="">&#40;</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, STRING<span style="">&#40;</span><span style="color: #666;">80</span><span style="">&#41;</span>, index=<span style="color: #4a587c;">True</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, STRING<span style="">&#40;</span><span style="color: #666;">20</span><span style="">&#41;</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'tail'</span>, BOOLEAN<span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'date_birth'</span>, DATE, default=<span style="color: #4a587c;">None</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'date_created'</span>, DATE, default=NOW<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="">&#93;</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">append</span><span style="">&#40;</span>name=u<span style="color: #657a8a;">'Schrödinger'</span>, type=<span style="color: #657a8a;">'cat'</span>, tail=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">pets</span>.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span><span style="">&#91;</span><span style="color: #666;">0</span><span style="">&#93;</span><br />
<br />
<span style="">&#91;</span>u<span style="color: #657a8a;">'Schrödinger'</span>, u<span style="color: #657a8a;">'cat'</span>, <span style="color: #4a587c;">True</span>, <span style="color: #4a587c;">None</span>, <span style="color: #657a8a;">'2011-08-17 19:16:46'</span><span style="">&#93;</span></code></span></span></p>
<h3>Creating a table from XML</h3>
<p>You can also pass&nbsp;<span class="inline_code">Table.xml</span>&nbsp;or <span class="inline_code">Query.xml</span> (see below) to <span class="inline_code">Database.create()</span>. An optional <span class="inline_code">name</span> parameter can then be used to give the new table a different name.</p>
<p>The optional <span class="inline_code">field</span> parameter is a function that takes each field name from the XML and returns a new field name to be used in the table. This is useful for <span class="inline_code">Query.xml</span>, where field names may contain a period (e.g., <span class="inline_code">pets.name</span>), which is not allowed in a table.&nbsp;</p>
<p>Alternatively, use the&nbsp;<span class="inline_code">Query.aliases</span>&nbsp;dictionary to define custom field names for the XML.</p>
<p>&nbsp;</p>
<hr />
<h2><a name="table"></a>Table</h2>
<p>A <span class="inline_code">Table</span> is a list of rows, consisting of one or more fields (i.e., table columns) of a certain type (i.e., strings or numbers). New tables can be created with the <span class="inline_code">Database.create()</span> method. An error is raised if a table with the given name already exists. Existing tables can be retrieved with <span class="inline_code">Database.tables[name]</span>, or <span class="inline_code">Database.&lt;name&gt;</span>.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">table = Database.<span style="">tables</span><span style="">&#91;</span>name<span style="">&#93;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">table.<span style="">db</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Parent Database.</span><br />
table.<span style="">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Table name (characters a-z + underscore).</span><br />
table.<span style="">fields</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of field names (i.e., columns).</span><br />
table.<span style="">schema</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Dictionary of (field, Schema)-items.</span><br />
table.<span style="">default</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of (field, value)-items for new rows.</span><br />
table.<span style="">pk</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Primary key field.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">table.<span style="">count</span><span style="">&#40;</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Total number of rows.</span><br />
table.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of rows, each a list of fields.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">table.<span style="">append</span><span style="">&#40;</span>values=<span style="">&#123;</span><span style="">&#125;</span>, commit=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
table.<span style="">update</span><span style="">&#40;</span><span style="color: #4a587c;">id</span>, values=<span style="">&#123;</span><span style="">&#125;</span>, commit=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
table.<span style="">remove</span><span style="">&#40;</span><span style="color: #4a587c;">id</span>, commit=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
table.<span style="color: #4a587c;">filter</span><span style="">&#40;</span>fields, filters<span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">table.<span style="">search</span><span style="">&#40;</span><span style="">*</span>args, <span style="">**</span>kwargs<span style="">&#41;</span> </code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">table.<span style="">xml</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># XML-string with the table schema and rows. </span><br />
table.<span style="">datasheet</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Datasheet object (see below).</span></code></span></p>
<ul>
<li><span class="inline_code">Table.append()</span>, <span class="inline_code">update()</span>,&nbsp;<span class="inline_code">remove()</span>&nbsp;modify the table contents – see further.</li>
<li>With <span class="inline_code">commit=False</span>, changes are only reflected after a&nbsp;<span class="inline_code">Database.commit()</span> (= faster in batch).&nbsp;</li>
<li><span class="inline_code">Table.filter()</span> returns a subset of rows with a subset of fields – see further.<br />For example: <span class="inline_code">table.filter('name', type='cat')</span>.</li>
</ul>
<h3>Table schema</h3>
<p>The <span class="inline_code">Table.schema</span> dictionary has a <span class="inline_code">Schema</span> object for each field name, containing field information:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">schema = Table.<span style="">schema</span><span style="">&#91;</span>fieldname<span style="">&#93;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">schema.<span style="">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Field name.</span><br />
schema.<span style="">type</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># STRING, INTEGER, FLOAT, TEXT, BLOB, BOOLEAN, DATE </span><br />
schema.<span style="">length</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># STRING field length.</span><br />
schema.<span style="">default</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Default value.</span><br />
schema.<span style="">index</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># PRIMARY | UNIQUE | True | False</span><br />
schema.<span style="">optional</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># True or False. </span></code></span></p>
<p>For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">pets</span>.<span style="">fields</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">pets</span>.<span style="">schema</span><span style="">&#91;</span><span style="color: #657a8a;">'name'</span><span style="">&#93;</span>.<span style="">type</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">pets</span>.<span style="">schema</span><span style="">&#91;</span><span style="color: #657a8a;">'name'</span><span style="">&#93;</span>.<span style="">length</span><br />
<br />
<span style="">&#91;</span><span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'tail'</span>, <span style="color: #657a8a;">'date_birth'</span>, <span style="color: #657a8a;">'date_created'</span><span style="">&#93;</span><br />
<span style="color: #657a8a;">'string'</span><br />
<span style="color: #666;">80</span> </code></span></span></p>
<h3>Append, update and remove rows</h3>
<p><span class="inline_code">Table.append()</span>&nbsp;adds a new row with the given field values.&nbsp;If the table has a primary key generated with <span class="inline_code">pk()</span>, returns the row's id (<span class="inline_code">None</span> otherwise).</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">append</span><span style="">&#40;</span>name=u<span style="color: #657a8a;">'Schrödinger'</span>, date_birth=date<span style="">&#40;</span><span style="color: #657a8a;">'2009-08-12'</span><span style="">&#41;</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">append</span><span style="">&#40;</span><span style="">&#123;</span><span style="color: #657a8a;">'name'</span>: u<span style="color: #657a8a;">'Schrödinger'</span>, <span style="color: #657a8a;">'date_birth'</span>: date<span style="">&#40;</span><span style="color: #657a8a;">'2009-08-12'</span><span style="">&#41;</span><span style="">&#125;</span><span style="">&#41;</span></code></span></span></p>
<p>If a field name does not allow it to be used as a function parameter, the field values can also be passed as a dictionary (e.g., Unicode strings like&nbsp;<em>data_de_creació</em>).</p>
<p><span class="inline_code">Table.update()</span>&nbsp;updates the values in the row with the given primary key. Instead of a primary key value, a selection of rows can also be updated using <span class="inline_code">any()</span>&nbsp;or <span class="inline_code">all()</span>&nbsp;(see further). In the third example, all rows with&nbsp;<span class="inline_code">type='cat'</span>&nbsp;will have their <span class="inline_code">tail</span> field set to&nbsp;<span class="inline_code">True</span>.</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">update</span><span style="">&#40;</span><span style="color: #666;">1</span>, type=<span style="color: #657a8a;">'cat'</span><span style="">&#41;</span> <span style="color: grey;"># set type='cat' in row with id=1.</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">update</span><span style="">&#40;</span><span style="color: #666;">1</span>, <span style="">&#123;</span><span style="color: #657a8a;">'type'</span>: <span style="color: #657a8a;">'cat'</span><span style="">&#125;</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">update</span><span style="">&#40;</span>all<span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#41;</span><span style="">&#41;</span>, tail=<span style="color: #4a587c;">True</span><span style="">&#41;</span></code></span></span></p>
<p><span class="inline_code">Table.remove()</span>&nbsp;removes the row with the given primary key:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">remove</span><span style="">&#40;</span><span style="color: #666;">1</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">remove</span><span style="">&#40;</span>ALL<span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">remove</span><span style="">&#40;</span>all<span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#41;</span>, <span style="color: #4a587c;">filter</span><span style="">&#40;</span>year<span style="">&#40;</span><span style="color: #657a8a;">'date_birth'</span><span style="">&#41;</span>, <span style="color: #666;">1990</span>, <span style="color: #657a8a;">'&lt;'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span></code></span></span></p>
<p>The last example removes all rows with <span class="inline_code">type='cat'</span>&nbsp;and year of birth before 1990.</p>
<p><span style="text-decoration: underline;">Note</span>: to insert binary data into a <span class="inline_code">BLOB</span> field, wrap it in <span class="inline_code">Database.binary()</span>.&nbsp;<br />For example: <span class="inline_code">db.images.append(src=db.binary(open('cat.png').read())))&nbsp;</span></p>
<h3><span>Filter rows</span></h3>
<p><span class="inline_code">Table.filter()</span> returns a list of rows filtered by field value(s), where each row is a list of fields.&nbsp;Its first argument defines which fields to yield for each row – either <span class="inline_code">ALL</span>, a field name or a list of field names. The second argument is a dictionary of field constraints. These can also be given as optional keyword parameters:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span><span style="">&#41;</span></code></span></span><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="">&#40;</span><span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'name'</span><span style="">&#41;</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span>ALL, type=<span style="color: #657a8a;">'cat'</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span>ALL, type=<span style="">&#40;</span><span style="color: #657a8a;">'cat'</span>, <span style="color: #657a8a;">'dog'</span><span style="">&#41;</span><span style="">&#41;</span> &nbsp; <span style="color: grey;"># type='cat' OR type='dog'</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span>ALL, type=<span style="color: #657a8a;">'cat'</span>, tail=<span style="color: #4a587c;">True</span><span style="">&#41;</span> <span style="color: grey;"># type='cat' AND tail=True </span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'id'</span>, <span style="">&#123;</span><span style="color: #657a8a;">'type'</span>: <span style="color: #657a8a;">'cat'</span>, <span style="color: #657a8a;">'tail'</span>: <span style="color: #4a587c;">True</span><span style="">&#125;</span><span style="">&#41;</span></code></span></span></p>
<p>For more intricate queries a <span class="inline_code">Query</span> object can be used.</p>
<p>&nbsp;</p>
<hr />
<h2><a name="query"></a>Query</h2>
<p><span class="inline_code">Table.search()</span> returns a <span class="inline_code">Query</span> object with options for filtering, sorting and ordering rows by field value(s). It can also include fields from other, related tables.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">query = Table.<span style="">search</span><span style="">&#40;</span> <br />
&nbsp; &nbsp; &nbsp;fields = ALL,<br />
&nbsp; &nbsp; filters = <span style="">&#91;</span><span style="">&#93;</span>,<br />
&nbsp; relations = <span style="">&#91;</span><span style="">&#93;</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp;sort = <span style="color: #4a587c;">None</span>,<br />
&nbsp; &nbsp; &nbsp; order = ASCENDING,<br />
&nbsp; &nbsp; &nbsp; group = <span style="color: #4a587c;">None</span>,<br />
&nbsp; &nbsp;function = FIRST,<br />
&nbsp; &nbsp; &nbsp; <span style="color: #4a587c;">range</span> = <span style="color: #4a587c;">None</span><br />
<span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">query.<span style="">table</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Parent Table.</span><br />
query.<span style="">fields</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Field name, list of field names or ALL.</span><br />
query.<span style="">aliases</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of (field name, alias)-items.</span><br />
query.<span style="">filters</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of filter() items.</span><br />
query.<span style="">relations</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of relation() items.</span><br />
query.<span style="">sort</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Field name or list of field names.</span><br />
query.<span style="">order</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># ASCENDING | DESCENDING</span><br />
query.<span style="">group</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Field name or list of field names.</span><br />
query.<span style="">function</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># FIRST, LAST, COUNT, MIN, MAX, SUM, AVG, CONCATENATE</span><br />
query.<span style="color: #4a587c;">range</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># (start, stop)-tuple, e.g. rows 11-20.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">query.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of rows, each a list of fields.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">query.<span style="">record</span><span style="">&#40;</span>row<span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of (field, value)-items for given row.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">query.<span style="">xml</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># XML-string with the query schema and rows.</span></code></span></p>
<h3>Query filters</h3>
<p>The <span class="inline_code">filter()</span> function creates a field-value constraint that will match certain rows in a table. A list of such filters can be passed to the <span class="inline_code">filters</span> parameter of the Query object.</p>
<p><span class="geshifilter"><code class="python geshifilter-python"><span style="color: #4a587c;">filter</span><span style="">&#40;</span>field, value, comparison=<span style="color: #657a8a;">'='</span><span style="">&#41;</span></code></span></p>
<table class="border">
<tbody>
<tr>
<td style="text-align: center;"><span class="smallcaps">Comparison</span></td>
<td><span class="smallcaps">Description</span></td>
<td><span class="smallcaps">Example</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">=</span></td>
<td>equal to</td>
<td><span class="inline_code">filter('type', ('cat', 'dog'), '=')&nbsp;</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">i=</span></td>
<td>equal to (case-insensitive)</td>
<td><span class="inline_code">filter('name', 'tig*', 'i=')&nbsp;</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">!=</span></td>
<td>not equal to</td>
<td><span class="inline_code">filter('name', '*y', '!=')</span>&nbsp;</td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">&gt;</span></td>
<td>greater than</td>
<td><span class="inline_code">filter('weight', 10, '&gt;') </span>&nbsp;</td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">&lt;</span></td>
<td>less than</td>
<td><span class="inline_code">filter('weight', 10, '&lt;')&nbsp;</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">&gt;=</span></td>
<td>greater than or equal to</td>
<td><span class="inline_code">filter(year('date'), 1999, '&gt;=')&nbsp;</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">&lt;=</span></td>
<td>less than or equal to</td>
<td><span class="inline_code">filter(year('date'), 2002, '&lt;=')</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="inline_code">:</span></td>
<td>between (inclusive)</td>
<td><span class="inline_code">filter(year('date'), (1999, 2002), ':')</span></td>
</tr>
</tbody>
</table>
<p>To work with a specific part of a <span class="inline_code">DATE</span> field (e.g., the year), wrap it in a&nbsp;<span class="inline_code">year()</span>, <span class="inline_code">month()</span>, <span class="inline_code">day()</span>, <span class="inline_code">hour()</span>, <span class="inline_code">minute()</span> or <span class="inline_code">second()</span> function.&nbsp;</p>
<p>Multiple filters can be chained together in an&nbsp;<span class="inline_code">all()</span> or <span class="inline_code">any()</span>&nbsp;list, using <span class="inline_code">AND</span> or <span class="inline_code">OR</span> logic respectively:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">all<span style="">&#40;</span>filter1, filter2, ...<span style="">&#41;</span> <span style="color: grey;"># Rows must match all of the filters.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">any<span style="">&#40;</span>filter1, filter2, ...<span style="">&#41;</span> <span style="color: grey;"># Rows must match one of the filters.</span></code></span></p>
<p>For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Database, <span style="color: #4a587c;">filter</span>, all, any<br />
<span style="">&gt;&gt;&gt;</span> db = Database<span style="">&#40;</span><span style="color: #657a8a;">'my_stuff'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">search</span><span style="">&#40;</span>filters=all<span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'Taxi'</span><span style="">&#41;</span>, <span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">search</span><span style="">&#40;</span>filters=any<span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'Taxi'</span><span style="">&#41;</span>, <span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span></code></span></span></p>
<p>The first query matches all cats named Taxi (i.e., <span class="inline_code">name='Taxi'</span>&nbsp;AND&nbsp;<span class="inline_code">type='cat'</span>). The second query matches any pet that is a cat or that is named 'Taxi' (i.e., <span class="inline_code">name='Taxi'</span> OR <span class="inline_code">type='cat'</span>).&nbsp;</p>
<p>Furthmore, <span class="inline_code">all()</span> and <span class="inline_code">any()</span> can be nested to create complex search criteria.&nbsp;The example below matches all pets that are cats, and whose name starts with an K- or ends with a -y:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> f = all<span style="">&#40;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> f.<span style="">append</span><span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'type'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> f.<span style="">append</span><span style="">&#40;</span>any<span style="">&#40;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'K*'</span><span style="">&#41;</span>, <span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'*y'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">pets</span>.<span style="">search</span><span style="">&#40;</span>filters=f<span style="">&#41;</span></code></span></span></p>
<h3>Query relations</h3>
<p>Relations are used to include fields from other tables. Say we have a <em>products</em> table and an <em>orders</em> table. We don't want all the product data in the <em>orders</em> table – this belongs in the <em>products</em> table so duplicate data is avoided (this is called <em>database normalization</em>). Each order contains the product id. Each product id can occur in multiple orders. When we run an <em>invoice</em> query for an order, we fetch the product description, price, etc. using a relation.</p>
<p>The <span class="inline_code">relation()</span> function defines a relation to another table, between two fields in the tables (usually id's):</p>
<p><span class="geshifilter"><code class="python geshifilter-python">relation<span style="">&#40;</span>field1, field2, table, join=LEFT<span style="">&#41;</span> <span style="color: grey;"># INNER | LEFT | RIGHT | FULL</span></code></span></p>
<ul>
<li><span class="inline_code">LEFT</span>&nbsp;selects all rows from the base table, with additional fields from the related table (if found). <br />If there is no link between <span class="inline_code">field1</span> and <span class="inline_code">field2</span>, the fields from the related table contain <span class="inline_code">None</span>.</li>
<li><span class="inline_code">RIGHT</span>&nbsp;is the reverse of <span class="inline_code">LEFT</span>.</li>
<li><span class="inline_code">FULL</span>&nbsp;means <span class="inline_code">LEFT</span> + <span class="inline_code">RIGHT</span>.</li>
<li><span class="inline_code">INNER</span> is like <span class="inline_code">LEFT</span>, but if there is no link between <span class="inline_code">field1</span> and <span class="inline_code">field2</span> that row is omitted.</li>
</ul>
<p>Below is an example of a simple products / customers / orders database:</p>
<table class="border=">
<tbody>
<tr>
<td>
<table class="border" style="margin: 0;">
<tbody>
<tr>
<td style="text-align: center;" colspan="3"><span class="smallcaps">products</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="smallcaps">id</span></td>
<td style="text-align: left;"><span class="smallcaps">Description</span></td>
<td style="text-align: center;"><span class="smallcaps">price</span></td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">pizza</td>
<td style="text-align: center;">15</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">garlic bread</td>
<td style="text-align: center;">3</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="border" style="margin: 0;">
<tbody>
<tr>
<td style="text-align: center;" colspan="3"><span class="smallcaps">customers</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="smallcaps">id</span></td>
<td style="text-align: left;"><span class="smallcaps">name</span></td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Schrödinger</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Hofstadter</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="border" style="margin: 0;">
<tbody>
<tr>
<td style="text-align: center;" colspan="3"><span class="smallcaps">orders</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="smallcaps">id</span></td>
<td style="text-align: center;"><span class="smallcaps">product_id</span></td>
<td style="text-align: center;"><span class="smallcaps">customer_id</span></td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Database, field, pk, INT<br />
<span style="">&gt;&gt;&gt;</span> db = Database<span style="">&#40;</span><span style="color: #657a8a;">'pizza_delivery'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">create</span><span style="">&#40;</span><span style="color: #657a8a;">'products'</span>, <span style="">&#40;</span>pk<span style="">&#40;</span><span style="">&#41;</span>, field<span style="">&#40;</span><span style="color: #657a8a;">'description'</span><span style="">&#41;</span>, field<span style="">&#40;</span><span style="color: #657a8a;">'price'</span>, INT<span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">create</span><span style="">&#40;</span><span style="color: #657a8a;">'customers'</span>, <span style="">&#40;</span>pk<span style="">&#40;</span><span style="">&#41;</span>, field<span style="">&#40;</span><span style="color: #657a8a;">'name'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">create</span><span style="">&#40;</span><span style="color: #657a8a;">'orders'</span>, <span style="">&#40;</span>pk<span style="">&#40;</span><span style="">&#41;</span>, field<span style="">&#40;</span><span style="color: #657a8a;">'product_id'</span>, INT<span style="">&#41;</span>, field<span style="">&#40;</span><span style="color: #657a8a;">'customer_id'</span>, INT<span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example">Add data:</span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">products</span>.<span style="">append</span><span style="">&#40;</span>description=<span style="color: #657a8a;">'pizza'</span>, price=<span style="color: #666;">15</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">products</span>.<span style="">append</span><span style="">&#40;</span>description=<span style="color: #657a8a;">'garlic bread'</span>, price=<span style="color: #666;">3</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">customers</span>.<span style="">append</span><span style="">&#40;</span>name=u<span style="color: #657a8a;">'Schrödinger'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> db.<span style="">customers</span>.<span style="">append</span><span style="">&#40;</span>name=u<span style="color: #657a8a;">'Hofstadter'</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> db.<span style="">orders</span>.<span style="">append</span><span style="">&#40;</span>product_id=<span style="color: #666;">1</span>, customer_id=<span style="color: #666;">2</span><span style="">&#41;</span></code></span></span></p>
<p><span class="example">Hofstadter orders a pizza. We use a query with relations between the tables to display the order:</span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Database, relation, LEFT<br />
<span style="">&gt;&gt;&gt;</span> db = Database<span style="">&#40;</span><span style="color: #657a8a;">'pizza_delivery'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> q = db.<span style="">orders</span>.<span style="">search</span><span style="">&#40;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp;fields = <span style="">&#40;</span><span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'customers.name'</span>, <span style="color: #657a8a;">'products.description'</span>, <span style="color: #657a8a;">'products.price'</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; relations = <span style="">&#40;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; relation<span style="">&#40;</span><span style="color: #657a8a;">'customer_id'</span>, <span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'customers'</span>, join=LEFT<span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; relation<span style="">&#40;</span><span style="color: #657a8a;">'product_id'</span>, <span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'products'</span>, join=LEFT<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> q.<span style="">fields</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> q.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span><br />
<br />
<span style="">&#91;</span><span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'customers.name'</span>, <span style="color: #657a8a;">'products.description'</span>, <span style="color: #657a8a;">'products.price'</span><span style="">&#93;</span><br />
<span style="">&#91;</span><span style="">&#91;</span><span style="color: #666;">1</span>, u<span style="color: #657a8a;">'Hofstadter'</span>, u<span style="color: #657a8a;">'pizza'</span>, <span style="color: #666;">15</span><span style="">&#93;</span><span style="">&#93;</span> </code></span></span></p>
<p><span class="example">Note: if a relation is used often, you can define it once with <span class="inline_code">Database.link()</span>. It will then be available in every <span class="inline_code">Query</span>.</span></p>
<h3>Grouping rows</h3>
<p>Rows in a <span class="inline_code">Query</span> are folded on duplicate values in the given <span class="inline_code">group</span> field. The given&nbsp;<span class="inline_code">function</span>&nbsp;is applied to the other fields. It can also be a list with a separate function for each field.</p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Function</span></td>
<td style="text-align: center;"><span class="smallcaps">Field</span></td>
<td><span class="smallcaps">Description</span></td>
</tr>
<tr>
<td><span class="inline_code">FIRST</span></td>
<td style="text-align: center;">any</td>
<td>The first field in the group.</td>
</tr>
<tr>
<td><span class="inline_code">LAST</span></td>
<td style="text-align: center;">&nbsp;any</td>
<td>The last&nbsp;field&nbsp;in the group.</td>
</tr>
<tr>
<td><span class="inline_code">COUNT</span></td>
<td style="text-align: center;">&nbsp;any</td>
<td>The number of rows in the group.</td>
</tr>
<tr>
<td><span class="inline_code">MIN</span></td>
<td style="text-align: center;"><span class="inline_code">INTEGER</span>&nbsp;+&nbsp;<span class="inline_code">FLOAT</span></td>
<td>The lowest&nbsp;field&nbsp;value in the group.</td>
</tr>
<tr>
<td><span class="inline_code">MAX</span></td>
<td style="text-align: center;"><span class="inline_code">INTEGER</span>&nbsp;+&nbsp;<span class="inline_code">FLOAT</span></td>
<td>The highest&nbsp;field&nbsp;value in the group.</td>
</tr>
<tr>
<td><span class="inline_code">SUM</span></td>
<td style="text-align: center;"><span class="inline_code">INTEGER</span>&nbsp;+&nbsp;<span class="inline_code">FLOAT</span></td>
<td>The sum of all&nbsp;field&nbsp;values in the group.</td>
</tr>
<tr>
<td><span class="inline_code">AVG</span></td>
<td style="text-align: center;"><span class="inline_code">INTEGER</span>&nbsp;+&nbsp;<span class="inline_code">FLOAT</span></td>
<td>The average of all&nbsp;field&nbsp;values in the group.</td>
</tr>
<tr>
<td><span class="inline_code">STDEV</span></td>
<td style="text-align: center;"><span class="inline_code">INTEGER</span>&nbsp;+&nbsp;<span class="inline_code">FLOAT</span></td>
<td>The standard deviation (= variation from average).</td>
</tr>
<tr>
<td><span class="inline_code">CONCATENATE</span></td>
<td style="text-align: center;"><span class="inline_code">STRING</span></td>
<td>Joins all field values with a comma.&nbsp;</td>
</tr>
</tbody>
</table>
<p>For example, to get the total revenue per ordered product:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">orders</span>.<span style="">search</span><span style="">&#40;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp;fields = <span style="">&#40;</span><span style="color: #657a8a;">'products.description'</span>, <span style="color: #657a8a;">'products.price'</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; relations = <span style="">&#40;</span>relation<span style="">&#40;</span><span style="color: #657a8a;">'product_id'</span>, <span style="color: #657a8a;">'id'</span>, <span style="color: #657a8a;">'products'</span><span style="">&#41;</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; group = <span style="color: #657a8a;">'products.description'</span>, <span style="color: grey;"># Fold products with same description.</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp;function = SUM<br />
<span style="">&gt;&gt;&gt;</span> <span style="">&#41;</span>.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span></code></span></span></p>
<p>To get the sum of a column for all rows in a table or query, simply use <span class="inline_code">sum()</span>:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> db.<span style="">products</span>.<span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #4a587c;">sum</span><span style="">&#40;</span><span style="color: #657a8a;">'price'</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#91;</span><span style="color: #666;">0</span><span style="">&#93;</span><span style="">&#91;</span><span style="color: #666;">0</span><span style="">&#93;</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="view"></a>View</h2>
<p><span class="inline_code">View</span>&nbsp;is a thin interface between a <span class="inline_code">Table</span> and an app. The <span class="inline_code">View.render()</span> method must be overridden in a subclass to yield rows in a certain output format (e.g., HTML). The outside world does not need to know about <span class="inline_code">Table</span> or <span class="inline_code">Query</span>&nbsp;– only what parameters can be fed to <span class="inline_code">render()</span>.</p>
<p>If the given table does not exist, the constructor will call&nbsp;<span class="inline_code">View.setup()</span> with the given schema&nbsp;of <span class="inline_code">field()</span> items to create it.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">view = View<span style="">&#40;</span>database, table_name, schema=<span style="">&#91;</span><span style="">&#93;</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">view.<span style="">db</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Parent Database.</span><br />
view.<span style="">table</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Parent Table.</span><br />
view.<span style="">schema</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of field()-items to create the table.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">view.<span style="">setup</span><span style="">&#40;</span>overwrite=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">view.<span style="">render</span><span style="">&#40;</span><span style="">*</span>args, <span style="">**</span>kwargs<span style="">&#41;</span> </code></span></p>
<p>For example, the following view renders a HTML <span class="inline_code">&lt;table&gt;</span>&nbsp;with products that match a search query:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Database, View<br />
<span style="">&gt;&gt;&gt;</span> db = Database<span style="">&#40;</span><span style="color: #657a8a;">'pizza_delivery'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">class</span> <span style="color:rgb(90, 150, 200)">Products</span><span style="">&#40;</span>View<span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">def</span> <span style="color: #4a587c;">__init__</span><span style="">&#40;</span><span style="color: #4a587c;">self</span>, database<span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; View.<span style="color: #4a587c;">__init__</span><span style="">&#40;</span><span style="color: #4a587c;">self</span>, database, <span style="color: #657a8a;">'products'</span>, schema=<span style="">&#91;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pk<span style="">&#40;</span><span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, STRING<span style="">&#41;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field<span style="">&#40;</span><span style="color: #657a8a;">'price'</span>, FLOAT<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp;<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">def</span> <span style="color:rgb(90, 150, 200)">render</span><span style="">&#40;</span><span style="color: #4a587c;">self</span>, query, <span style="">**</span>kwargs<span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; q = <span style="color: #4a587c;">self</span>.<span style="">table</span>.<span style="">search</span><span style="">&#40;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fields = <span style="">&#91;</span><span style="color: #657a8a;">'description'</span>, <span style="color: #657a8a;">'price'</span><span style="">&#93;</span>, <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filters = <span style="">&#91;</span><span style="color: #4a587c;">filter</span><span style="">&#40;</span><span style="color: #657a8a;">'description'</span>, <span style="color: #657a8a;">'*'</span>+q+<span style="color: #657a8a;">'*'</span><span style="">&#41;</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; html = <span style="">&#91;</span><span style="">&#93;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">for</span> row <span style="color: #28334f; font-weight: bold;">in</span> q.<span style="">rows</span><span style="">&#40;</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r = <span style="">&#91;</span><span style="">&#93;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">for</span> i, field <span style="color: #28334f; font-weight: bold;">in</span> <span style="color: #4a587c;">enumerate</span><span style="">&#40;</span>q.<span style="">fields</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r.<span style="">append</span><span style="">&#40;</span><span style="color: #657a8a;">'&lt;td class=&quot;%s&quot;&gt;%s&lt;/td&gt;'</span> <span style="">%</span> <span style="">&#40;</span>field, <span style="">string</span><span style="">&#40;</span>row<span style="">&#91;</span>i<span style="">&#93;</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; html.<span style="">append</span><span style="">&#40;</span><span style="color: #657a8a;">'&lt;tr&gt;%s&lt;/tr&gt;'</span> <span style="">%</span> <span style="color: #657a8a;">''</span>.<span style="">join</span><span style="">&#40;</span>r<span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">return</span> <span style="color: #657a8a;">'&lt;table&gt;'</span> + <span style="color: #657a8a;">''</span>.<span style="">join</span><span style="">&#40;</span>html<span style="">&#41;</span> + <span style="color: #657a8a;">'&lt;/table&gt;'</span><br />
<span style="">&gt;&gt;&gt;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> Products<span style="">&#40;</span><span style="">&#41;</span>.<span style="">render</span><span style="">&#40;</span>q=<span style="color: #657a8a;">'bread'</span><span style="">&#41;</span><br />
<br />
<span style="color: #657a8a;">'&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;description&quot;&gt;garlic bread&lt;/td&gt;&lt;td class=&quot;price&quot;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;'</span> </code></span></span></p>
<p><span class="example">When <span class="inline_code">View</span>&nbsp;is used as a </span><a href="http://www.cherrypy.org/" target="_blank">CherryPy</a> web page, <span class="inline_code">render()</span> will be called with&nbsp;<span class="inline_code">args</span>&nbsp;as a list of parts in the relative URL, and <span class="inline_code">kwargs</span> as a dictionary of all <span class="inline_code">POST</span> and <span class="inline_code">GET</span> variables sent from the client. For example, <span class="inline_code">http://pizzadelivery.com/products/search?q=bread</span>&nbsp;→ <span class="inline_code">['products', 'search']</span> +<span class="inline_code"> {'q': 'bread'}</span>.</p>
<p>&nbsp;</p>
<hr />
<h2><a name="datasheet"></a>Datasheet</h2>
<p><span class="inline_code">Datasheet</span> is a matrix of rows and columns, where each row and column can be retrieved as a Python list. The data is not stored in a database but can be imported / exported as a CSV-file. Optionally, the given&nbsp;<span class="inline_code">fields</span> is a list of (<span class="inline_code">name</span>, <span class="inline_code">type</span>)-items where <span class="inline_code">type</span> can be <span class="inline_code">STRING</span>, <span class="inline_code">TEXT</span>, <span class="inline_code">INTEGER</span>, <span class="inline_code">FLOAT</span>, <span class="inline_code">BOOLEAN</span>, <span class="inline_code">BLOB</span> or <span class="inline_code">DATE</span>.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet = Datasheet<span style="">&#40;</span>rows=<span style="">&#91;</span><span style="">&#93;</span>, fields=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">datasheet = Datasheet.<span style="">load</span><span style="">&#40;</span>path, separator=<span style="color: #657a8a;">','</span>, decoder=<span style="color: #28334f; font-weight: bold;">lambda</span> v: v, headers=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">rows</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of rows (each row = list of values).</span><br />
datasheet.<span style="">columns</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of columns (each column = list of values).</span><br />
datasheet.<span style="">fields</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of (name, type) column headers.</span><br />
datasheet.<span style="">&lt;</span>field<span style="">&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of column values. </span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet<span style="">&#91;</span>i<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Row with index i.</span><br />
datasheet<span style="">&#91;</span>i, j<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Value in row i at column j.</span><br />
datasheet<span style="">&#91;</span>i1:i2, j<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Slice of column j from rows i1-i2.</span><br />
datasheet<span style="">&#91;</span>i, j1:j2<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Slice of columns j1-j2 from row i.</span><br />
datasheet<span style="">&#91;</span>i1:i2, j1:j2<span style="">&#93;</span> &nbsp; &nbsp; <span style="color: grey;"># Datasheet with columns j1-j2 from rows i1-i2.</span><br />
datasheet<span style="">&#91;</span>:<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Datasheet copy. </span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">insert</span><span style="">&#40;</span>i, row, default=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
datasheet.<span style="">append</span><span style="">&#40;</span>row, default=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
datasheet.<span style="">extend</span><span style="">&#40;</span>rows, default=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
datasheet.<span style="">copy</span><span style="">&#40;</span>rows=ALL, columns=ALL<span style="">&#41;</span> </code></span><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">group</span><span style="">&#40;</span>j, function=FIRST, key=<span style="color: #28334f; font-weight: bold;">lambda</span> value: value<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">save</span><span style="">&#40;</span>path, separator=<span style="color: #657a8a;">','</span>, encoder=<span style="color: #28334f; font-weight: bold;">lambda</span> v: v, headers=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">json</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># JSON-formatted string.</span></code></span></p>
<ul>
<li><span class="inline_code">Datasheet.insert()</span> and <span class="inline_code">append()</span> fill missing columns (at the right) with a <span class="inline_code">default</span> value.</li>
<li><span class="inline_code">Datasheet.columns.insert()</span> and <span class="inline_code">append()</span> fill missing rows (bottom) with the default.<br />An optional <span class="inline_code">field</span> parameter can be used to supply a (<span class="inline_code">name</span>, <span class="inline_code">type</span>) column header.&nbsp;</li>
<li><span class="inline_code">Datasheet.copy()</span> returns a new <span class="inline_code">Datasheet</span>&nbsp;from a selective list of row and/or column indices.<br />To flip a datasheet, do: <span class="inline_code">datasheet.copy(rows=datasheet.columns)</span>.</li>
</ul>
<h3>Grouping rows</h3>
<p><span class="inline_code">Datasheet.group()</span> returns a new&nbsp;<span class="inline_code">Datasheet</span>&nbsp;with unique values in column <span class="inline_code">j</span>, by grouping rows with the given function.&nbsp;The <span class="inline_code">function</span> takes a list of column values and returns a single value. Predefined functions are:&nbsp;<span class="inline_code">FIRST</span>, <span class="inline_code">LAST</span>, <span class="inline_code">COUNT</span>, <span class="inline_code">MIN</span>, <span class="inline_code">MAX</span>, <span class="inline_code">SUM</span>, <span class="inline_code">AVG</span>, <span class="inline_code">STDEV</span>,&nbsp;<span class="inline_code">CONCATENATE</span>. It can also be a list of functions, one for each column. A <span class="inline_code">TypeError</span>&nbsp;is raised when a function cannot handle the data in its column.&nbsp;</p>
<p>The <span class="inline_code">key</span> argument can be used to prepare the values in column <span class="inline_code">j</span> for comparison, for example: <span class="inline_code">key=lambda date: date.year</span> groups a column of <span class="inline_code">Date</span> objects by year.&nbsp;</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Datasheet, uid, <span style="">pprint</span><br />
<span style="">&gt;&gt;&gt;</span> ds = Datasheet<span style="">&#40;</span>rows=<span style="">&#91;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="">&#91;</span>uid<span style="">&#40;</span><span style="">&#41;</span>, u<span style="color: #657a8a;">'Schrödinger'</span>, <span style="color: #657a8a;">'cat'</span><span style="">&#93;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="">&#91;</span>uid<span style="">&#40;</span><span style="">&#41;</span>, u<span style="color: #657a8a;">'Hofstadter'</span>, &nbsp;<span style="color: #657a8a;">'cat'</span><span style="">&#93;</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="">&#91;</span>uid<span style="">&#40;</span><span style="">&#41;</span>, u<span style="color: #657a8a;">'Taxi'</span>, &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #657a8a;">'dog'</span><span style="">&#93;</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> g = ds.<span style="">copy</span><span style="">&#40;</span>columns=<span style="">&#91;</span><span style="color: #666;">2</span>,<span style="color: #666;">0</span><span style="">&#93;</span><span style="">&#41;</span> <span style="color: grey;"># A copy with the type and id columns.</span><br />
<span style="">&gt;&gt;&gt;</span> g = g.<span style="">group</span><span style="">&#40;</span><span style="color: #666;">0</span>, COUNT<span style="">&#41;</span> &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Group by type, count rows per type.</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="">pprint</span><span style="">&#40;</span>g, fill=<span style="color: #657a8a;">''</span><span style="">&#41;</span><br />
<br />
cat &nbsp;<span style="color: #666;">2</span> <br />
dog &nbsp;<span style="color: #666;">1</span></code></span></span></p>
<p><span class="example">The example below uses a custom concatenate function:</span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> g = ds.<span style="">copy</span><span style="">&#40;</span>columns=<span style="">&#91;</span><span style="color: #666;">2</span>,<span style="color: #666;">1</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> g = g.<span style="">group</span><span style="">&#40;</span><span style="color: #666;">0</span>, function=<span style="color: #28334f; font-weight: bold;">lambda</span> <span style="color: #4a587c;">list</span>: <span style="color: #657a8a;">'+'</span>.<span style="">join</span><span style="">&#40;</span><span style="color: #4a587c;">list</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="">pprint</span><span style="">&#40;</span>g, fill=<span style="color: #657a8a;">''</span><span style="">&#41;</span><br />
<br />
cat &nbsp;Schrödinger+Hofstadter<br />
dog &nbsp;Taxi &nbsp; &nbsp; </code></span></span></p>
<h3>Sorting rows &amp; columns</h3>
<p><span class="inline_code">Datasheet.columns[j].sort()</span> sorts the rows in the matrix according to the values in column <span class="inline_code">j</span>.&nbsp;<br /><span class="inline_code">Datasheet.columns.sort()</span>&nbsp;is useful when you set its&nbsp;<span class="inline_code">order</span>&nbsp;parameter, which is a list of columns indices:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> ds.<span style="">columns</span>.<span style="">sort</span><span style="">&#40;</span>order=<span style="">&#91;</span><span style="color: #666;">0</span>,<span style="color: #666;">2</span>,<span style="color: #666;">1</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="">pprint</span><span style="">&#40;</span>ds, fill=<span style="color: #657a8a;">''</span><span style="">&#41;</span><br />
<br />
<span style="color: #666;">1</span> &nbsp;cat &nbsp;Schrödinger<br />
<span style="color: #666;">2</span> &nbsp;cat &nbsp;Hofstadter<br />
<span style="color: #666;">3</span> &nbsp;dog Taxi</code></span></span></p>
<p><span class="inline_code">Datasheet.columns.swap()</span> swaps two individual columns with given indices.</p>
<h3>Helper commands: uid &amp; pprint</h3>
<p>The <span class="inline_code">pattern.table</span> module has two commands that are useful in combination with a <span class="inline_code">Datasheet</span>:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">uid<span style="">&#40;</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python"><span style="">pprint</span><span style="">&#40;</span>datasheet, truncate=<span style="color: #666;">40</span>, padding=<span style="color: #657a8a;">&quot; &quot;</span>, fill=<span style="color: #657a8a;">&quot;.&quot;</span><span style="">&#41;</span></code></span></p>
<p>The <span class="inline_code">uid()</span> command returns a unique number, starting from 1, useful for a column index.</p>
<p>The <span class="inline_code">pprint()</span> command pretty-prints the table, with columns aligned vertically. The <span class="inline_code">truncate</span> parameter defines the maximum column width, <span class="inline_code">padding</span> the spacing between columns and <span class="inline_code">fill</span> the character used for spacing.</p>
<h3>CSV import &amp; export</h3>
<p>CSV (c<em>omma-separated values</em>) is a simple text format for tabular data, where each row is a new line and each value is separated by a comma.</p>
<p><span class="inline_code">Datasheet.save()</span> exports the table as a CSV file.<br /><span class="inline_code">Datasheet.load()</span> returns a&nbsp;<span class="inline_code">Datasheet</span> from a given CSV file.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet = Datasheet.<span style="">load</span><span style="">&#40;</span>path, separator=<span style="color: #657a8a;">','</span>, decoder=<span style="color: #28334f; font-weight: bold;">lambda</span> v: v, headers=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">datasheet.<span style="">save</span><span style="">&#40;</span>path, separator=<span style="color: #657a8a;">','</span>, encoder=<span style="color: #28334f; font-weight: bold;">lambda</span> v: v, headers=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span></p>
<p>When saving a CSV file, <span class="inline_code">str</span>, <span class="inline_code">int</span>, <span class="inline_code">float</span>, <span class="inline_code">bool</span> and <span class="inline_code">Date</span> are converted to <span class="inline_code">unicode</span>. For other data types a custom <span class="inline_code">encoder</span> must be given.&nbsp;When loading a CSV file, all values in the datasheet will be <span class="inline_code">unicode</span>&nbsp;unless a custom <span class="inline_code">decoder</span> is given.</p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;">With <span class="inline_code">headers=True</span>, the headers in&nbsp;<span class="inline_code">Datasheet.fields</span>&nbsp;are saved to + loaded from CSV. In this case, the data type for each column is explicitly known and no <span class="inline_code">encoder</span> or <span class="inline_code">decoder</span> is necessary.</p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;"><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> Datasheet, STRING, DATE, date<br />
<span style="">&gt;&gt;&gt;</span> ds1 = Datasheet<span style="">&#40;</span>fields=<span style="">&#91;</span><span style="">&#40;</span><span style="color: #657a8a;">'name'</span>, STRING<span style="">&#41;</span>, <span style="">&#40;</span><span style="color: #657a8a;">'date'</span>, DATE<span style="">&#41;</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> ds1.<span style="">append</span><span style="">&#40;</span><span style="">&#91;</span>u<span style="color: #657a8a;">'Schrödinger'</span>, date<span style="">&#40;</span><span style="color: #657a8a;">'August 12, 1887'</span><span style="">&#41;</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> ds1.<span style="">append</span><span style="">&#40;</span><span style="">&#91;</span>u<span style="color: #657a8a;">'Hofstadter'</span>, date<span style="">&#40;</span><span style="color: #657a8a;">'February 15, 1945'</span><span style="">&#41;</span><span style="">&#93;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> ds1.<span style="">save</span><span style="">&#40;</span><span style="color: #657a8a;">'test.txt'</span>, headers=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> ds2 = Datasheet.<span style="">load</span><span style="">&#40;</span><span style="color: #657a8a;">'test.txt'</span>, headers=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> ds2.<span style="">fields</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> ds2<span style="">&#91;</span><span style="color: #666;">0</span><span style="">&#93;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> type<span style="">&#40;</span>ds2<span style="">&#91;</span><span style="color: #666;">0</span>,<span style="color: #666;">1</span><span style="">&#93;</span><span style="">&#41;</span><br />
<br />
<span style="">&#91;</span><span style="">&#40;</span>u<span style="color: #657a8a;">'name'</span>, <span style="color: #657a8a;">'string'</span><span style="">&#41;</span>, <span style="">&#40;</span>u<span style="color: #657a8a;">'date'</span>, <span style="color: #657a8a;">'date'</span><span style="">&#41;</span><span style="">&#93;</span><br />
<span style="">&#91;</span>u<span style="color: #657a8a;">'Schrödinger'</span>, Date<span style="">&#40;</span><span style="color: #657a8a;">'1887-08-12 00:00:00'</span><span style="">&#41;</span><span style="">&#93;</span><br />
<span style="">&lt;</span>class <span style="color: #657a8a;">'pattern.db.Date'</span><span style="">&gt;</span> </code></span></span></p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;">&nbsp;</p>
<hr />
<h2><a name="date"></a>Date</h2>
<p>The <span class="inline_code">Date</span> object is a convenient subclass of Python's <span class="inline_code">datetime.datetime</span>.&nbsp;The <span class="inline_code">date()</span> command returns a <span class="inline_code">Date</span> object. A date can be generated from an integer (Unix timestamp), a string or <span class="inline_code">NOW</span>. Optionally, an input format (e.g. <span class="inline_code">"%d/%m/%Y"</span>) and an output format for <span class="inline_code">str()</span> can be given. The default format is <span class="inline_code">"YYYY-MM-DD hh:mm:ss"</span>. Use&nbsp;<span class="inline_code">Date.timestamp</span>&nbsp;to get a Unix timestamp.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span><span style="color: #4a587c;">int</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span>NOW, format=DEFAULT<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span><span style="">string</span>, format=DEFAULT<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span><span style="">string</span>, inputformat, format=DEFAULT<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span>year, month, day, format=DEFAULT<span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">date<span style="">&#40;</span>year, month, day, hours, minutes, seconds, format=DEFAULT<span style="">&#41;</span></code></span></p>
<p>If no input format is given, a number of common formats will be tried:</p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Format</span></td>
<td><span class="smallcaps">Example</span></td>
</tr>
<tr>
<td><span class="inline_code">%Y-%m-%d %H:%M:%S</span></td>
<td>2010-09-21 09:27:01</td>
</tr>
<tr>
<td><span class="inline_code">%a, %d %b %Y %H:%M:%S %z</span></td>
<td>Tue, 9 Sep 2010 17:58:28 +0000</td>
</tr>
<tr>
<td><span class="inline_code">%Y-%m-%dT%H:%M:%SZ</span></td>
<td>2010-09-20T09:27:01Z</td>
</tr>
<tr>
<td><span class="inline_code">%Y-%m-%dT%H:%M:%S+0000</span></td>
<td>2010-09-20T09:27:01+0000</td>
</tr>
<tr>
<td><span class="inline_code">%Y-%m-%d %H:%M</span></td>
<td>2010-09-20 09:27</td>
</tr>
<tr>
<td><span class="inline_code">%Y-%m-%d</span></td>
<td>2010-09-20</td>
</tr>
<tr>
<td><span class="inline_code">%d/%m/%Y</span></td>
<td>20/09/2010</td>
</tr>
<tr>
<td><span class="inline_code">%d %B %Y</span></td>
<td>9 september 2010</td>
</tr>
<tr>
<td><span class="inline_code">%B %d %Y</span></td>
<td>September 9 2010</td>
</tr>
<tr>
<td><span class="inline_code">%B %d, %Y</span></td>
<td>September 09, 2010</td>
</tr>
</tbody>
</table>
<p>All date formats used in <span class="inline_code">pattern.web</span>&nbsp;(e.g., a Bing search result) are automatically detected.<br />For a full overview of date format syntax, see: <a href="http://docs.python.org/library/time.html#time.strftime" target="_blank">http://docs.python.org/library/time.html#time.strftime</a>.</p>
<p><span style="font-variant: small-caps;"><br />Date calculations</span></p>
<p>The <span class="inline_code">time()</span> command can be used to add (or subtract) time to a <span class="inline_code">Date</span>:</p>
<p><span class="geshifilter"><code class="python geshifilter-python"><span style="">time</span><span style="">&#40;</span>days=<span style="color: #666;">0</span>, seconds=<span style="color: #666;">0</span>, minutes=<span style="color: #666;">0</span>, hours=<span style="color: #666;">0</span><span style="">&#41;</span></code></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">db</span> <span style="color: #28334f; font-weight: bold;">import</span> date, <span style="">time</span><br />
<span style="">&gt;&gt;&gt;</span> d &nbsp;= date<span style="">&#40;</span><span style="color: #657a8a;">'23 august 2011'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> d += <span style="">time</span><span style="">&#40;</span>days=<span style="color: #666;">2</span>, hours=<span style="color: #666;">5</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> type<span style="">&#40;</span>d<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> d<br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> d.<span style="">year</span>, d.<span style="">month</span>, d.<span style="">day</span><br />
<br />
<span style="">&lt;</span>class <span style="color: #657a8a;">'pattern.db.Date'</span><span style="">&gt;</span><br />
<span style="color: #666;">2011</span>-08-<span style="color: #666;">25</span> 05:00:00<br />
<span style="color: #666;">2011</span>, <span style="color: #666;">8</span>, <span style="color: #666;">25</span> </code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2>See also</h2>
<ul>
<li><a href="http://www.cherrypy.org/" target="_blank">CherryPy</a> (BSD): o<span>bject-oriented HTTP framework for Python.</span></li>
<li><span><a href="https://www.djangoproject.com/" target="_blank">Django</a> (BSD): m</span><span>odel-view-controller framework for Python.</span></li>
</ul>
</div>
</div></div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>
</body>
</html>